var TWF2;window.TimepadWF=window.TimepadWF||{},function(TWF2){var widgetsBase="js/tpwf/widgets/",widgetMarkAttr="data-timepad-widget-v2",widgetCustomizedAttr="data-timepad-customized",widgetUrlAttr="data-timepad-widget-url",jqUrl="js/tpwf/lib/jquery-1.9.1-nc.min.js?v=2",jqMin="1.9.1";TWF2.xdm={libRoot:"js/tpwf/lib/easyxdm-2.4.17/",libUrl:"easyXDM.min.js",libUrlDebug:"easyXDM.debug.js",swfUrl:"timepad.swf",json2Url:"json2.js",nameUrl:"name.html",corsUrl:"cors.html",debug:!1},TWF2._timestamp="1594632410937",TWF2.WidgetPrototypes=TWF2.WidgetPrototypes||{},TWF2.packages={jquery:function(t){return void 0===t&&(t=""),TWF2.T$?[]:(window.$&&window.$.fn&&window.$.fn.jquery&&$.fn.jquery.split(".")[0]<2&&[$.fn.jquery,jqMin].sort()[1]===$.fn.jquery&&(TWF2.T$=window.$,window.TimepadWF.T$=TWF2.T$),TWF2.T$?[]:[t+jqUrl])},easyxdm:function(t){return[t+TWF2.xdm.libRoot+(TWF2.xdm.debug?TWF2.xdm.libUrlDebug:TWF2.xdm.libUrl),t+TWF2.xdm.libRoot+TWF2.xdm.json2Url]},polyfills:{getScripts:function(t){return window.XDomainRequest?[t+"js/tpwf/lib/jquery.xdomain.min.js"]:[]},getRequirements:function(){return["jquery"]}},mustache:function(t){return[t+"js/tpwf/lib/mustache-nc.min.js?v=2"]},masonry:function(t){return[t+"js/tpwf/lib/jquery.masonry-nc.min.js"]},momentjs:{sandbox:"momentjs",ordered:!0,getScripts:function(t){return[t+"js/lib/moment/2.17.1/moment.min.js",t+"js/lib/moment/2.17.1/locale/ru.min.js"]}}},TWF2.getWidget=function(t){return void 0===t&&(t=0),Loader.getInstance().widgets[t]._instance},TWF2.parentWidgetTop=0,TWF2.childWidgetTop=0;var RichWidget=function(){function RichWidget(context){var _this=this;this._timestamp=TWF2._timestamp,this.tpls={},this.tplsc={},this.obs=new Observable(this),this.appliedCSS="",this._appendedJS=[],this._appendedCSS=[],this.corsChannels=[],this.drawingContexts={},this.currentTpl="main",this.title=document.title,this.virtualUrlRoot="/",this.state={},this.isReady=!1,this.locale="ru",this.localizedTpls={},this.logBuffer=[],this.lastClickEvent=null,this.abortableXhr={},this.metrikaLoaded={},this.gaLoaded={};var l=this.mklog("constructor");this.routes=this.routes||{main:{}},this.context=context,this.settings=TWF2.cascade(this.settings,context.settings),this.model={widgetInfo:{host:context.base,id:context.wuid,num:context.num},settings:this.settings},this.tpls=extend({},this._tpls),this.settings.trackers=this.settings.trackers||{},this.startWaitingFor=this.startWaitingFor.bind(this),l("Loading packages %O",this.packages),context.loadPackages(this.packages,function(){l("Packages loaded"),_this.T$=TWF2.T$,_this.M$=TWF2.Mustache;var inlineDT=TWF2.T$(_this.context.getRenderTarget());if(_this.setRenderTargetPointers({contexts:{$inline:inlineDT},d:inlineDT,container:inlineDT,currentDocumentNode:window.document,$currentDocumentNode:TWF2.T$(window.document),currentWindowNode:window}),TWF2.T$.fn.getCleanDOMElement=TWF2.T$.fn.getCleanDOMElement||function(){var t=this.get(0);return!t.nodeName&&t.get&&(t=t.get(0)),t},TWF2.T$.fn.findEx=TWF2.T$.fn.findEx||function(t){var n=this.find(t);return n.get&&n.get(0)instanceof TWF2.T$&&n.each(function(t,e){n[t]=TWF2.T$(e).get(0)}),n},TWF2.T$.fn.TWFiter=TWF2.T$.fn.TWFiter||function(n){this.each(function(t,e){n(TWF2.T$(e),t)})},TWF2.T$.fn.caret=TWF2.T$.fn.caret||function(t){return void 0===t&&(t=null),TWF2.JQueryCommon.$caret(this,t)},TWF2.T$.fn.tpphone=TWF2.T$.fn.tpphone||function(){return TWF2.JQueryCommon.$tpphone(this)},l("Packages ready"),_this.context.customizationId&&_this.context.customizationData){_this.customizationId=_this.context.customizationId,l("Applying customizations");var response=_this.context.customizationData;if(response.tpls)for(var tplname in response.tpls)response.tpls.hasOwnProperty(tplname)&&(_this.tpls[tplname]=response.tpls[tplname]);if(response.css&&_this.applyCSS(response.css),response.js){var customJsFunction;l("[custom js] custom js detected, parsing");try{customJsFunction=eval(response.js),l("[custom js] parsed")}catch(t){l("[custom js] syntax parse error: "+t)}l("[custom js] executing");try{customJsFunction.bind(_this)()}catch(t){l("[custom js] runtime error: "+t)}}response.settings&&response.settings instanceof Array&&(response.settings={}),_this.settings=cascade(_this.settings,response.settings,context.settings),_this.model.settings=_this.settings,response.owner&&response.relation&&(_this.customizationOwner={id:response.owner,ownerType:response.relation}),_this.postInit()}else _this.postInit();_this.$currentDocumentNode.find("body:first").on("click",function(t){_this.lastClickEvent=t})})}return RichWidget.prototype.getRenderTargetPointers=function(){var t={};return extend(t,this.drawingContexts),{contexts:t,d:this.d,container:this.container,$currentDocumentNode:this.$currentDocumentNode,currentDocumentNode:this.currentDocumentNode,currentWindowNode:this.currentWindowNode,appendedJS:this._appendedJS.slice(0),appendedCSS:this._appendedCSS.slice(0)}},RichWidget.prototype.setRenderTargetPointers=function(t){this.drawingContexts=t.contexts,this.d=t.d,this.container=t.container,this.$currentDocumentNode=t.$currentDocumentNode,this.currentDocumentNode=t.currentDocumentNode,this.currentWindowNode=t.currentWindowNode,this._appendedJS=t.appendedJS||[],this._appendedCSS=t.appendedCSS||[],this.corsChannels=[],this.log("Changed render target pointers")},RichWidget.prototype.postInit=function(){var _this=this,trmark="POSTINIT",trid=TWF2.microguid(4),H=TWF2.Collections.H,s=this.settings;if(this.elog(trmark,"PostInit started",trid),this.initialRoute=!0,this.localizedTpls[this.locale]=this.tpls,s.customizationOwner&&(this.elog(trmark,"Overriding customizationOwner to %O",trid,s.customizationOwner),this.customizationOwner=s.customizationOwner),s.locale&&(this.elog(trmark,"Locale explicitly set to %s",trid,s.locale),this.switchLocale(s.locale)),s.initialRoute&&(this.elog(trmark,"overriding initialRoute to %s",trid,s.initialRoute),this.currentTpl=s.initialRoute),s.bindEvents&&H.each(s.bindEvents,function(t,e){var n;_this.elog(trmark,"binding event %s => %s",trid,t,e),"function"==typeof t?n=t:window[t]&&(n=window[t]),n&&_this.obs.listen(e,n.bind(_this))}),s.overrideTemplates&&(this.elog(trmark,"overriding templates",trid),H.each(s.overrideTemplates,function(t,e){return _this.tpls[e]=_this.T$(t).html()})),s.loadLocaleStrings&&(this.elog(trmark,"overriding localeStrings",trid),this._locales=TWF2.cascade(this._locales,s.loadLocaleStrings)),s.loadModel){this.elog(trmark,"loading additional model via loadModel",trid);var el=this.T$("script#"+s.loadModel).get(0);this.model=TWF2.cascade(this.model,eval(this.context.loader.extractScriptSrc(el)))}s.apiDomain&&(this.elog(trmark,"apidomain overriden to %s",trid,s.apiDomain),this.context.baseDomain=s.apiDomain);var ready=function(){_this.obs.fireEvent("preReady",{}),_this.ready()};s.loadJS?(this.elog(trmark,"loading additional js via loadJS",trid,s.apiDomain),this.context.loader.includeJS(s.loadJS,function(){return ready()})):ready()},RichWidget.prototype.ready=function(){var _this=this;if(this.log("all ready"),this.isReady=!0,this.applyCustomizationOwner(),"block"===this.settings.display)this.log("DisplayMode = classic"),this.route();else if(this.settings.loadCSS=this.settings.loadCSS||[],!this.settings.skipBaseCSS&&this.extCss&&this.settings.loadCSS.unshift(this.extCss),"iframe"===this.settings.display&&this.settings.iframe)this.log("DisplayMode = iframe"),this.switchToIframe(this.settings.iframe,function(){_this.route()});else if("popup"===this.settings.display&&this.settings.popup){this.log("DisplayMode = popup");var popupOpen=function(n){void 0===n&&(n={}),_this.openSwitchToIframePopup(_this.settings.iframe,_this.settings.popup,function(t,e){_this.currentTpl=null,_this.route(null,n),_this.loadCloseConfirm(e)},function(){_this.currentTpl=null,_this.state={}})};this.obs.listen("openPopup",popupOpen),this.settings.popup.triggerSelector?(this.log("Popup will appear on triggerSelector: "+this.settings.popup.triggerSelector),this.T$("body").on("click",this.settings.popup.triggerSelector,function(e){e.preventDefault(),_this.log("Popup trigerred");var targetStateString=_this.T$(e.currentTarget).data("twf-target-state"),targetState={};targetStateString&&(_this.log("twf-target-state detected!"),targetState=eval(targetStateString)),popupOpen(targetState)}),this.settings.popup.autoRun&&(this.log("autoRun is set, opening popup before any clicks"),popupOpen())):(this.log("No triggerSelector, opening popup at once"),popupOpen())}},RichWidget.prototype.loadCloseConfirm=function(t){var n=this.settings.popup.closeConfirm,i=this.getText.bind(this);if(n){TWF2.Collections.H.each(n.texts,function(t,e){return n.texts[e]=i(t)});var e=this.renderTemplate("_closing_confirmation",this.settings.popup.closeConfirm.texts);this.T$(t).find("body").append(e)}},RichWidget.prototype.applyCustomizationOwner=function(){var t=this.customizationOwner,e=this.model;t&&("partner"==t.ownerType?e.partner=t.id:"organization"==t.ownerType&&(e.organization=t.id),this.virtualUrlRoot+=t.ownerType+"/"+t.id+"/")},RichWidget.prototype.changeView=function(t){var e=this.currentTpl;this.currentTpl=t,this.repaint(),!this.settings.noScrollToWidgetOnViewChange&&e&&e!=t&&this.scrollToElement(this.container)},RichWidget.prototype.getTemplate=function(t){return this.tplsc[t]||(this.log("[tplsc] compiling tpl"),this.tplsc[t]=this.M$.compile(this.tpls[t])),this.tplsc[t]},RichWidget.prototype.renderTemplate=function(t,e){return this.T$(this.getTemplate(t)(e).trim())},RichWidget.prototype.repaint=function(t){void 0===t&&(t=this.currentTpl),this.obs.fireEvent("preRepaint",{tpl:t,d:this.d}),this.log("[repaint] repainting"),this.d.html(this.getTemplate(t)(this.model,this.tpls)),this.appliedCSS&&this.drawingContexts.$iframe&&(this.log("[repaint] applying additional css"),this.currentDocumentNode.head.appendChild(this.context.createStyleTag(this.appliedCSS))),this.log("[repaint] repainted"),this.obs.fireEvent("postRepaint",{tpl:t,d:this.d})},RichWidget.prototype.repaintSection=function(t){this.elog("repaint","partial repaint of %s",TWF2.microguid(4),t),this.$$(".js-section-"+t).replaceWith(this.renderTemplate("_"+t,this.model))},RichWidget.prototype.error=function(t){this.obs.fireEvent("error",{message:t}),this.log(t)},RichWidget.prototype.outputLog=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=[t].concat(e),o=TWF2.Collections.A;if(window.console&&this.settings.debug){var r=window.console.log;if(console.log.apply||(r=Function.prototype.bind.call(window.console.log,window.console)),!this.context.loader.logger&&(this.context.loader.logger=this.outputLog.bind(this),this.context.loader.logBuffer&&this.context.loader.logBuffer.length)){var a=this.context.loader.logBuffer;this.context.loader.logBuffer=[],this.log("---Loader buffered log start---"),o.each(a,function(t){return r.apply(console,t)}),this.log("---Loader buffered log end---")}if(this.logBuffer&&this.logBuffer.length){var s=this.logBuffer;this.logBuffer=[],this.log("---Buffered log start---"),o.each(s,function(t){return r.apply(console,t)}),this.log("---Buffered log end---")}r.apply(console,i)}else this.logBuffer.push(i)},RichWidget.prototype.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t="["+this.context.name+this.context.num+"] "+t,this.outputLog.apply(this,[t].concat(e))},RichWidget.prototype.elog=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var r=[e="["+t+"]["+n+"] "+e];r=r.concat(i),this.log.apply(this,r)},RichWidget.prototype.mklog=function(i){var o=this,r=TWF2.microguid(4);return function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.unshift(i,t,r),o.elog.apply(o,e)}},RichWidget.prototype.openCORS=function(n,i){var o=this;this.log("[CORS] Opening cors for "+n),this.context.loader.loadPackage("easyxdm",n,function(){var e,t=o.corsChannels;t[n]?t[n].loaded?(o.log("[CORS] Already opened cors for "+n),i&&i(t[n].channel)):(o.log("[CORS] Already opening cors for "+n),i&&t[n].onLoad.push(i)):(t[n]={loaded:!1,onLoad:[],channel:null},i&&t[n].onLoad.push(i),t[n].channel=e=new easyXDM.Rpc({remote:n+TWF2.xdm.libRoot+TWF2.xdm.corsUrl,swf:n+TWF2.xdm.libRoot+TWF2.xdm.swfUrl,swfNoThrottle:!0,onReady:function(){t[n].loaded=!0,t[n].onLoad.forEach(function(t){return t&&t(e)},o),o.log("[CORS] Opened cors for "+n)}},{remote:{request:{}}}))})},RichWidget.prototype.abortPreviousXhr=function(t,e){var n=this.mklog("abortPreviousXhr");this.abortableXhr[t]&&(n("Found previous xhr, aborting"),this.abortableXhr[t].abort(),delete this.abortableXhr[t]),n("Running wrapped xhr"),this.abortableXhr[t]=e()},RichWidget.prototype.prependConsumerHost=function(t,e){return void 0===e&&(e={}),this.context.prependConsumerHost(t,e)},RichWidget.prototype.route=function(e,t){var n=this;void 0===t&&(t={}),e=e||(this.settings.initialRoute||"main"),t.action=e,this.initialRoute||!equalsEX(this.state,t)?(this.state=t,this.routes[e]||(e="main"),this.log("[routing] Routing to "+e),this.obs.fireEvent("preRoute",{isInitial:this.initialRoute,action:e,state:t}),this.routes[e]?this[e](t,function(t){void 0===t&&(t=e),n.log("[routing] Route code ok, rendering view %s",t),n.changeView(t),n.log("[routing] View rendered"),n.obs.fireEvent("routed",arguments)}):this.error("Route not found"),this.initialRoute=!1):this.log("[routing] Routed to same state, no action.")},RichWidget.prototype.metrikaLoad=function(a,n){var i=this;void 0===n&&(n="yam");var s=this.mklog("Metrika/"+n),o=this.settings.trackers[n];if(o&&o.enable&&n){if(this.metrikaLoaded[n])return s("Already loaded, calling back"),void(a&&a(this.metrikaLoaded[n]));function c(t){if(window[r])return s("Tracker %s already exists on page",o.trackerId),i.metrikaLoaded[n]=window[r],void(t&&t(window[r]));try{s("Creating new Ya.Metrika %s",o.trackerId);var e=new Ya.Metrika({id:parseInt(o.trackerId),trackLinks:!0,accurateTrackBounce:!0});window[r]=e,s("loaded"),i.metrikaLoaded[n]=window[r],t&&t(e)}catch(t){s("failed to load %s",t)}}var r="yaCounter"+o.trackerId.toString();window.Ya&&window.Ya.Metrika?(s("Using existing Ya"),c(a)):(s("Loading Ya.Metrika object"),function(t,e,n){s("Ya.Metrika object Ready"),(e[n]=e[n]||[]).push(function(){c(a)});function i(){o.parentNode.insertBefore(r,o)}var o=t.getElementsByTagName("script")[0],r=t.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://mc.yandex.ru/metrika/watch.js","[object Opera]"==e.opera?t.addEventListener("DOMContentLoaded",i,!1):i()}(document,window,"yandex_metrika_callbacks"))}else s("No config for this tracker, aborting")},RichWidget.prototype.redirectTo=function(t){window.frames&&window.frames.top&&window.frames.top.location?window.frames.top.location.replace(t):window.location.replace(t)},RichWidget.prototype.roistatLoad=function(t){void 0===t&&(t="roistat");var c=this.mklog("Roistat/"),e=this.settings.trackers[t];e&&e.trackerId&&(window.roistat||window.roistatProjectId?c("Already loaded"):(c("Loading Roistat object"),function(t,e,n,i){c("Roistat object Ready"),t.roistatProjectId=i,t.roistatHost=n;var o="https:"==e.location.protocol?"https://":"http://",r=/^.*roistat_visit=[^;]+(.*)?$/.test(e.cookie)?"/dist/module.js":"/api/site/1.0/"+i+"/init",a=e.createElement("script");a.charset="UTF-8",a.async=1,a.src=o+n+r;var s=e.getElementsByTagName("script")[0];s.parentNode.insertBefore(a,s)}(window,document,"cloud.roistat.com",e.trackerId)))},RichWidget.prototype.gaLoad=function(t,i){var o=this;void 0===i&&(i="ga");var r=this.mklog("GA/"+i),a=TWF2.Collections.H,s=this.settings.trackers[i];if(r("gaLoad %s %O",i,s),s&&s.enable){if(this.gaLoaded[i])return r("Already loaded, calling back"),void(t&&t(window.ga,s));function c(t){return o.model.ga_cid=t.get("clientId")}function e(e){var t=TWF2.Collections.A.whereSingle(window.ga.getAll(),function(t){return t.get("trackingId")==s.trackerId});if(t)return s.trackerName=t.get("name"),r("Tracker %s already exists on page, assiging its name, %s",s.trackerId,s.trackerName),c(t),o.gaLoaded[i]=!0,void(e&&e(window.ga,s));r("Creating new tracker %s/%s %O",s.trackerName,s.trackerId,s);var n={name:s.trackerName};s.isOrg&&(n.cookieDomain="none"),window.ga("create",s.trackerId,"auto",n),window.ga(s.trackerName+".require","displayfeatures"),window.ga(function(){var n=window.ga.getByName(s.trackerName),t=c(n);r("Setting client id %s for tracker",t),n.set("dimension1",t),s.setData&&(r("Setting additional data %O to tracker %s/%s",s.setData,s.trackerName,s.trackerId),a.each(s.setData,function(t,e){return n.set(e,t)})),o.gaLoaded[i]=!0,e&&e(window.ga,s)})}var n,d,l,u,p;window.ga&&!window.tp_ga_disabled?r("Using existing GA"):(r("Loading ga manually"),window.tp_ga_disabled&&this.settings.forceAnalytics&&(r("Deleting placeholder"),delete window.ga,delete window.tp_ga_disabled),n=window,d=document,l="ga",n.GoogleAnalyticsObject=l,n.ga=n.ga||function(){(n.ga.q=n.ga.q||[]).push(arguments)},n.ga.l=+new Date,u=d.createElement("script"),p=d.getElementsByTagName("script")[0],u.async=1,u.src="//www.google-analytics.com/analytics.js",p.parentNode.insertBefore(u,p)),window.ga(function(){return e(t)})}else r("No config for this tracker, aborting")},RichWidget.prototype.gaTrackVirtualUrl=function(n,i,t){var o=this;void 0===i&&(i=function(){}),void 0===t&&(t="ga");var e=this.settings.trackers[t],r=this.mklog("GA.gaTrackVirtualUrl");e&&e.enable?(r("Trying to track %s",n),n=this.virtualUrlRoot+n,this.gaLoad(function(t,e){"timepad.ru"!=o.context.baseDomain&&(n="/testing_env"+n),encodeURIComponent&&(n+="?embedder="+encodeURIComponent(document.location.href)),t(e.trackerName+".send","pageview",n),r("Tracked %s",n),i()})):r("Tracker %s unavailable, aborting",t)},RichWidget.prototype.$$=function(t){return this.$currentDocumentNode.findEx(t)},RichWidget.prototype.appendResourcesToNewIframeTarget=function(t){var e=this,n=this.mklog("iframe-resource");this.obs.fireEvent("iframeModePreResourcesAppend",{}),this.appendCSS(this.settings.loadCSS,function(){n("CSS ready!"),e.settings.skipBaseCSS||(e.log("Loading base css (this._css)"),e.appendCSSCode(e._css)),e.appendCSSCode(e.getLoaderCSS()),e.obs.fireEvent("iframeModePostResourcesAppend",{}),t()})},RichWidget.prototype.switchToIframe=function(t,a){var s=this,c=this,d=this.mklog("switchToIframe");if(d("Switching..?"),c.drawingContexts.iframeRoot)return d("Already in iframe, abort"),void a();c.d.empty(),TWF2.T$.extend(!0,t,{target:this.d,name:this.context.wuid+"_iframe"}),d("Creating iframe"),this.context.createIframeRenderTarget(t,function(t,e,n){d("Iframe created");var i=TWF2.T$(e),o=TWF2.T$(n),r=TWF2.T$(t);s.T$(s.context.suspectedPlaceholder).hasClass("twf-iframe-placeholder")&&s.T$(s.context.suspectedPlaceholder).remove(),c.setRenderTargetPointers({contexts:{$iframe:r,iframeRoot:i,$iframeElement:o},$currentDocumentNode:i,currentDocumentNode:e,currentWindowNode:n.contentWindow,d:r,container:o}),d("Switched, appending resources"),s.obs.fireEvent("switchedToNewRenderTarget",{}),s.appendResourcesToNewIframeTarget(function(){s.obs.fireEvent("iframeModeReady",{}),d("Switch process complete, calling back"),a()})})},RichWidget.prototype.openSwitchToIframePopup=function(t,e,s,n){var c=this,d=this,i=this.getRenderTargetPointers(),l=this.mklog("openSwitchToIframePopup");l("Switching"),TWF2.T$.extend(!0,t,{name:this.context.wuid+"_popup"}),d.context.createIframePopupRenderTarget(t,e,function(t,e,n,i){l("Popup render target created");var o=TWF2.T$(e),r=TWF2.T$(n),a=TWF2.T$(t);d.setRenderTargetPointers({contexts:{$iframe:a,iframeRoot:o,$iframeElement:r},$currentDocumentNode:o,currentDocumentNode:e,currentWindowNode:n.contentWindow,d:a,container:r}),l("Switched, appending resources"),c.obs.fireEvent("switchedToNewRenderTarget",{}),c.appendResourcesToNewIframeTarget(function(){d.context.appendEscHandler(n,e,i),c.obs.fireEvent("iframeModeReady",{}),s(i,e)})},function(t){c.log("Switching back from iframe popup"),d.setRenderTargetPointers(i),n&&n()})},RichWidget.prototype.printUrl=function(t,i){var e=this,o=this.mklog("printURL");o("Sending request to %s",t),this.T$.get(t).done(function(n){o("Response recieved. Creating iframe with content %O",n),e.context.createIframeElement({width:1,height:0,autoHeight:!1},function(t){TWF2.T$(e.context._embedPoint).parent().after(t)},function(t,e){t.onload=function(){o("Iframe ready, printing"),t.contentWindow.print(),i&&i(),o("Setting timeout to remove iframe"),setTimeout(function(){o("Removing iframe"),e.remove()},5e3)},o("Writing response to iframe"),t.contentWindow.document.write(n),t.contentWindow.document.close()})})},RichWidget.prototype.computeScrollOffset=function(t,e){var n=t.ownerDocument.defaultView||t.ownerDocument.parentWindow,i=this.T$(t).offset().top,o=+this.T$(t).data("offsetTop"),r=(e?e+"/":"")+TWF2.microguid(4),a="ScrollOffset";this.elog(a,"Calculating offset of %o",r,t),this.elog(a,"Inner offset = %d",r,i);try{o?(this.elog(a,"detected precalculated offset: %d",r,o),i+=o):n.frameElement&&(this.elog(a,"trying to go up",r),i+=this.computeScrollOffset(n.frameElement,r))}catch(t){this.elog(a,"couldn't get any higer: %s",r,t)}return this.elog(a,"Total offset = %d",r,i),i},RichWidget.prototype.scrollToElement=function(t){this.log("[scrollToElement] Computing scrolling offset");var e=this.computeScrollOffset(t.get(0));if(this.log("[scrollToElement] computedOffset = "+e),this.settings.iframe&&this.settings.iframe.useVkScroll&&window.VK){this.log("[scrollToElement] scrolling in VK mode");try{window.VK.init(function(){window.VK.callMethod("scrollWindow",e,100)})}catch(t){this.log("[scrollToElement] vk mode failed: "+t)}}else TWF2.T$("html,body").animate({scrollTop:e},"fast")},RichWidget.prototype.appendCSSCode=function(t){var e=this.context.createStyleTag(t,this.currentDocumentNode);this.appendCSSTag(e),e.styleSheet&&(e.styleSheet.cssText=t)},RichWidget.prototype.appendCSSTag=function(t){try{this.currentDocumentNode.getElementsByTagName("head")[0].appendChild(t)}catch(t){this.log("Failed to append CSS: "+t.message)}},RichWidget.prototype.appendCSS=function(t,e){var i=this,n=t.length,o=this.mklog("AppendCSS");if(o("Append CSS %O",t),n){function r(){return function(){--n||(o("All CSS loaded!"),e&&e())}}t.forEach(function(t){if(i._appendedCSS[t])i._appendedCSS[t].loaded?r()():i._appendedCSS[t].onLoad.push(r());else{o("Appending %s",t),i._appendedCSS[t]={loaded:!1,onLoad:[r()]};var e=i.context.cachebustUrl(t),n=i.T$("<link>").attr("rel","stylesheet").attr("href",e);n.load(function(){o("Loaded: %s",t),i._appendedCSS[t].onLoad.forEach(function(t){return t()},i),i._appendedCSS[t].loaded=!0}),i.$$("head").append(n)}})}else e&&e()},RichWidget.prototype.applyCSS=function(t){var e=TWF2.stringHash(t);this.elog("CSS","Applying CSS code",e),t&&(this.appliedCSS+=t,this.elog("CSS","adding additional css to apply storage",e))},RichWidget.prototype.appendJS=function(t,e,n){var i=this,o=t.length;if(o){function r(t){return function(){--o||(i.log("[AppendJS] All ready!"),e&&e())}}t.forEach(function(t){if(i._appendedJS[t])i._appendedJS[t].loaded?r()():i._appendedJS[t].onLoad.push(r());else{i.log("[AppendJS] Appending "+t),i._appendedJS[t]={loaded:!1,onLoad:[r()]};var e=i.context.cachebustUrl(t),n=i.context.loader.createScriptElement(e,!1,function(){i._appendedJS[t].onLoad.forEach(function(t){return t()},i),i._appendedJS[t].loaded=!0},i.getRenderTargetPointers().currentDocumentNode);i.$$("head").get(0).appendChild(n)}})}else e&&e()},RichWidget.prototype.getLoaderCSS=function(){return".tpwf-loader-fadeable{transition:opacity .12s ease-in-out}.tpwf-loader-fadeable--fade{opacity:.1}.tpwf-loader-circle{position:absolute;top:0;left:0;right:0;bottom:0;max-height:300px;display:flex;flex-direction:column;justify-content:center;align-items:center;overflow:hidden}.tpwf-loader-gif{margin:24px 28px;max-width:64px;border:24px solid #f7f7f7;border-radius:50%}.tpwf-loader-caption{text-align:center;font-family:sans-serif;font-size:19px;line-height:27px;margin:15px 64px;color:rgba(0,0,0,.6)}.tpwf-loader-animation-in{animation:loader-animation-in cubic-bezier(1,.01,.9,1) .3s;animation-iteration-count:1;transform-origin:50% 50%}@keyframes loader-animation-in{0%{opacity:0;transform:scale(0.9) translateY(-16px)}100%{opacity:1;transform:scale(1) translateY(0)}}.tpwf-loader-animation-out{animation:loader-animation-out cubic-bezier(1,.01,.9,1) .3s;animation-iteration-count:1;transform-origin:50% 50%}@keyframes loader-animation-out{0%{opacity:1;transform:scale(1) translateY(0)}100%{opacity:0;transform:scale(0.9) translateY(16px)}}"},RichWidget.prototype.startWaitingFor=function(t,e){var n,i,o=this,r=this.T$,a=this.currentWindowNode,s=(this.d.innerWidth(),this.d.innerHeight(),r(this.currentDocumentNode.createElement("img")).attr("src",this.context.base+"img/loader_sq.gif").addClass("tpwf-loader-gif")),c=r(this.currentDocumentNode.createElement("div")).addClass("tpwf-loader-circle").append(s),d=(this.context.getMaxZIndex(this.d),this.getRenderTargetPointers().container.first().offset().top),l=r(window).scrollTop(),u=r(a.parent),p=r(window),h=!1,g=!1;if(a.parent!=a)try{for(var f=a,m=f.top.pageYOffset,w=16;0<w--&&f.parent!=f;)m+=f.pageYOffset-r(f.frameElement).offset().top,f=f.parent;l=m,g=!0}catch(t){h=!0}if(0<(i=h?this.lastClickEvent?this.lastClickEvent.pageY-128:0:g?l:u[0]==p[0]?(TWF2.parentWidgetTop=d,l-TWF2.parentWidgetTop):(TWF2.childWidgetTop=d,l-TWF2.parentWidgetTop-TWF2.childWidgetTop))){i+300>r(this.currentDocumentNode).height()&&(i=r(this.currentDocumentNode).height()-300);var v=i+"px";c.css("top",v)}return e&&e.caption&&(n=r(this.currentDocumentNode.createElement("div")).addClass("tpwf-loader-caption").text(e.caption),c.append(n)),this.d.addClass("tpwf-loader-fadeable tpwf-loader-fadeable--fade"),c.insertAfter(this.$currentDocumentNode.find("body")).addClass("tpwf-loader-animation-in"),function(){c.removeClass("tpwf-loader-animation-in").addClass("tpwf-loader-animation-out"),setTimeout(function(){return c.remove()},250),o.d.removeClass("tpwf-loader-fadeable--fade"),t&&t()}},RichWidget.prototype.waitFor=function(t,e){var n=null;e&&e.onEndWait&&(n=e.onEndWait),t(this.startWaitingFor(n,e))},RichWidget.prototype.plural=function(t,e,n,i){var o=(t=Math.abs(t)%100)%10;return 10<t&&t<20?i:1<o&&o<5?n:1==o?e:i},RichWidget.prototype.switchLocale=function(t){var e=this,n=this.mklog("Locale");this.locale!=t?(n("Switching locale to %s",t),this.tpls={},this.tplsc={},this.dictionary=this._locales[t]||{},this.locale=this.model.locale=t,this.localizedTpls[t]?(n("Loading cached localized tpls"),this.tpls=this.localizedTpls[t]):(n("Localizing tpls"),this.T$.each(this.localizedTpls.ru,function(t,n){e.T$.each(e.dictionary,function(t,e){n=n.replace(new RegExp(t,"g"),e)}),e.tpls[t]=n}))):n("Locale is already %s, doing nothing",t)},RichWidget.prototype.getText=function(t,e){var n=this.dictionary&&this.dictionary[t]||t;return e&&this.T$.each(e,function(t,e){return n=n.replace("%s",e)}),n},RichWidget.prototype.sendEventToCube=function(e,t,n){var i=this,o=this.prependConsumerHost("api/"+e+"/create",{subdom:"cube"}),r={method:"post",crossDomain:!0,dataType:"jsonp",data:{data:t,hash:n}};this.log("[CUBE] reporting "+e),this.T$.ajax(o,r).done(function(t){t.error?i.log("[CUBE] error while reporting "+e+": "+t.error):i.log("[CUBE] reported "+e)})},RichWidget.prototype.sendEventToTracker=function(e,t){var n=this.mklog("Tracker"),i=this.prependConsumerHost("api/track"),o={method:"post",crossDomain:!0,dataType:"json",data:{tracked_event:e,data:t}};n("Reporting %s %O",e,t),this.T$.ajax(i,o).done(function(t){t.error?n("Error while reporting %s: %s",e,t.error):n("Reported %s",e)})},RichWidget.prototype.$unfold=function(t,n){var i=[];return this.T$.each(t,function(t,e){return i.push(n(t,e))}),i},RichWidget.prototype.$reserializeRequest=function(t){var e,n=TWF2.Collections.A,i=this.T$.param(t).replace(/\+/g," ").split("&"),o=n.map(i,function(t){return decodeURIComponent(t)}),r={};return n.each(o,function(t){e=t.split("="),r[e[0]]=e[1]}),r},RichWidget.prototype.reserializeHash=function(t){var n,i={},o=0;return this.T$.each(t,function(t,e){(n=e.name.match(/(.*)\[\]$/))?i[n[1]+"["+o+++"]"]=e.value:i[e.name]=e.value}),i},RichWidget.prototype.loadSubWidget=function(t,e,n,i){e.debug=this.settings.debug;var o,r,a,s=this.T$.Deferred();return i||(o=document.createElement("div")),r={widgetSettings:e,loader:this.context.loader,customizationId:+n,embedPoint:i||o,base:this.context.base,baseDomain:this.context.baseDomain,window:this.context.window},a=new WidgetRunner(t,r),o&&(a.renderTarget=document.createElement("div")),a.load(function(t){return s.resolve(t)}),s},RichWidget.prototype.getSvogeConfig=function(){return{host:this.prependConsumerHost("",{noSlash:!0}),searchWindow:window.svoge&&window.timePadVars?window:null}},RichWidget.prototype.loadSvoge=function(t){var e=this;this.appendJS([this.prependConsumerHost("js/svoge.js")],function(){t.svoge=new t.Svoge(e.getSvogeConfig(),e),t.svoge.watch()},!0)},RichWidget.prototype.loadTPPhone=function(){return this.T$.Deferred().resolve()},RichWidget}();TWF2.RichWidget=RichWidget;var Loader=function(){function Loader(){this._includedJS={},this._sandboxes={},this._includedCSS={},this._corsChannels={},this._packages={},this._loadingWidgets=!1,this._requestedMore=!1,this.lastNumber=0,this.logBuffer=[],this.obs=new Observable(this)}return Loader.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[+e]=arguments[e];t[0]="[Loader] "+t[0],this.logger?this.logger.apply(this,t):this.logBuffer.push(t)},Loader.prototype.createScriptElement=function(t,e,n,i){var o=(i=i||document).createElement("script");return o.src=t,o.charset="UTF-8",e&&(o.async=!0),n&&(o.onload=o.onreadystatechange=function(){o.readyState&&!/complete|loaded/.test(o.readyState)||(o.onload=null,o.onreadystatechange=null,n())}),o},Loader.prototype.loadPackage=function(e,n,t){var i=this;this.log("Requested package %s",e);var o=TWF2.Collections.A,r=TWF2.Util.F;if(a=this._packages[e])a.loaded?(this.log("package %s already available, calling back",e),t&&t()):t&&(this.log("package %s is loading, adding callback to queue",e),a.onLoad.push(t));else{this.log("Loading package %s...",e);var a=this._packages[e]={onLoad:[],loaded:!1};t&&a.onLoad.push(t);var s=TWF2.packages[e],c=[],d=[];c=s.getScripts?(this.log("Loading package %s in modern mode",e),s.getScripts(n)):(this.log("Loading package %s in original mode",e),s(n)),s.getRequirements&&(d=s.getRequirements());function l(){i.log("all package %s scripts ready, calling back",e),a.loaded=!0,o.each(a.onLoad,function(t){return t()}),a.onLoad=[]}function u(){if(c.length){i.log("Loading package %s scripts",e);var n={sandbox:s.sandbox};if(s.ordered){i.log("package %s reqires ordered loading",e);var t=o.map(c,function(t){return[t]});r.chain(function(t,e){return i.includeJS([e[0]],t,n)},t,l)}else i.includeJS(c,l,n)}else i.log("package %s has no scripts",e),l()}if(d.length){this.log("package %s requires %O",e,d);var p=new TWF2.Util.F.all(u);o.each(d,function(t){return i.loadPackage(t,n,p.cb())}),p.wait()}else this.log("package %s requires nothing",e),u()}},Loader.prototype.getSandbox=function(t){return this._sandboxes[t]},Loader.prototype.includeJS=function(t,e,r){var a=this;void 0===e&&(e=function(){}),void 0===r&&(r={});var n=t.length;if(n){function s(t){return function(){--n||e()}}t.forEach(function(i){if(a._includedJS[i])a._includedJS[i].loaded?s()():a._includedJS[i].onLoad.push(s());else{a._includedJS[i]={loaded:!1,onLoad:[s()]};function t(t){var e=a.createScriptElement(i,!0,function(){a._includedJS[i].onLoad.forEach(function(t){return t()},a),a._includedJS[i].onLoad=[],a._includedJS[i].loaded=!0},t),n=t.getElementsByTagName("script")[0];if(!n)return t.getElementsByTagName("head")[0].appendChild(e);n.parentNode.insertBefore(e,n)}if(r.sandbox){if(!a._sandboxes[r.sandbox]){var e=document.createElement("IFRAME"),n=document.getElementsByTagName("body")[0];e.setAttribute("style","width: 0; height: 0; opacity: 0; position: absolute; left: -9999999px;"),n.appendChild(e);var o=e.contentWindow;o.document.write("<!DOCTYPE html>\n<html><head></head><body></body></html>"),o.document.close(),a._sandboxes[r.sandbox]=o}t(a._sandboxes[r.sandbox].document)}else t(window.document)}})}else e()},Loader.prototype.openCORS=function(t,n){var i=this;void 0===n&&(n=function(t){}),this.loadPackage("easyxdm",t,function(){var e;i._corsChannels[t]?i._corsChannels[t].loaded?n(i._corsChannels[t].channel):i._corsChannels[t].onLoad.push(n):(i._corsChannels[t]={loaded:!1,onLoad:[n],channel:null},i._corsChannels[t].channel=e=new easyXDM.Rpc({remote:t+TWF2.xdm.libRoot+TWF2.xdm.corsUrl,swf:t+TWF2.xdm.libRoot+TWF2.xdm.swfUrl,swfNoThrottle:!0,onReady:function(){i._corsChannels[t].loaded=!0,i._corsChannels[t].onLoad.forEach(function(t){return t&&t(e)},i)}},{remote:{request:{}}}))})},Loader.getInstance=function(){return window.TWF2L=window.TWF2L||new Loader,window.TWF2L},Loader.prototype.getNewNumber=function(){return this.lastNumber++},Loader.prototype.loadWidget=function(t,e,n){var i=this,o=(t.getAttribute("src")||t.getAttribute("data-src")).match(/^(?:https?:)?\/\/([\da-z\._:-]+)\//i),r=(n=TWF2.cascade({widgetSettings:e,loader:this,customizationId:+t.getAttribute(widgetCustomizedAttr),embedPoint:t,url:t.getAttribute(widgetUrlAttr),base:o[0],baseDomain:t.getAttribute("data-timepad-apidomain")||o[1],window:window},n||{}),new WidgetRunner(t.getAttribute(widgetMarkAttr),n));return t.removeAttribute(widgetMarkAttr),r.suspectedPlaceholder=getPreviousElementSibling(t),r.suspectedPlaceholder&&r.suspectedPlaceholder.getAttribute&&r.suspectedPlaceholder.getAttribute("data-twf-placeholder")&&(r.placeholderURL=r.suspectedPlaceholder.getAttribute("href"),t.parentNode.removeChild(r.suspectedPlaceholder)),this.widgets.push(r),r.load(function(){i.obs.fireEvent("widgetLoaded",{rnr:r})}),r},Loader.prototype.extractScriptSrc=function(t){var e,n=t.textContent||t.innerHTML,i=new RegExp("(\\(\\s*function\\s*\\(\\s*\\)[.\\S\\s]*\\(\\s*\\);)","i");return!n&&t.childNodes&&t.childNodes.length&&(n=t.childNodes[0].nodeValue),n=(e=n.match(i))&&e.length?e[0]:""},Loader.prototype.getDataAttrSettings=function(t){var n,i,o={},r=function(t,e,n){var i=e.pop();e.length?(t[i]||(t[i]={}),r(t[i],e,n)):t[i]=n};return TWF2.Collections.H.each(t.attributes,function(t,e){t&&t.nodeName&&(n=t.nodeName.match(/^data-twf2s-(.+)/))&&n.length&&(i=n[1],r(o,i.split("--").reverse(),t.value))}),o},Loader.prototype.loadWidgets=function(){if(this._loadingWidgets)this._requestedMore=!0;else{this.widgets=this.widgets||[],this._loadingWidgets=!0;var scripts=document.getElementsByTagName("script"),settingsString,compiledSettings,dataAttrSettings,i;for(i=0;i<scripts.length;i++)if(scripts[i].getAttribute(widgetMarkAttr)){if(settingsString=this.extractScriptSrc(scripts[i]),settingsString)try{compiledSettings=eval(settingsString)}catch(t){compiledSettings={}}dataAttrSettings=this.getDataAttrSettings(scripts[i]),this.loadWidget(scripts[i],TWF2.cascade(compiledSettings,dataAttrSettings));break}this._loadingWidgets=!1,this._requestedMore&&(this._requestedMore=!1,this.loadWidgets())}},Loader}();TWF2.Loader=Loader;var WidgetRunner=(sg.prototype.load=function(e){var n=this;if(this.startMinimalSpinner(),!this.url){var t=this.name;this.url=this.base+widgetsBase+"comp/"+t+".min.js"}var i=new TWF2.MassLoader;this.log("Loading widget js");var o=this.cachebustUrl(this.url);this.loader.includeJS([o],i.addEvent("widgetJsAndPackages")),this.log("preloading jQuery and mustache packages"),this.loader.loadPackage("jquery",this.base,i.addEvent("jqueryPackage")),this.loader.loadPackage("mustache",this.base,i.addEvent("mustachePackage")),this.log("requesting customizations"),this.customizationId&&this.jsonp(this.prependConsumerHost("api/widget_customization_get"),i.addEvent("customizations"),{widget:this.customizationId}),i.wait(function(t){t.customizations&&(n.customizationData=t.customizations[0]),n.obs.fireEvent("preInstantiate",{},n),n._instance=new TWF2.WidgetPrototypes[n.name](n),n.obs.fireEvent("postInstantiate",{},n),e&&e(n._instance)})},sg.prototype.log=function(){for(var t,e,n=[],i=0;i<arguments.length;i++)n[+i]=arguments[i];n[0]="[runner] "+n[0],this._instance?(t=this._instance).log.apply(t,n):(e=this.loader).log.apply(e,n)},sg.prototype.jsonp=function(t,e,n){void 0===n&&(n={});var i="?",o="twfjsonp_"+Date.now();TWF2.Collections.H.each(n,function(t,e){return i+=encodeURIComponent(e)+"="+encodeURIComponent(t)+"&"}),window[o]=function(t){e(t);try{delete window[o]}catch(t){}window[o]=null},this.loader.includeJS([t+i+"callback="+o])},sg.prototype.cachebustUrl=function(t){if(!t.match(new RegExp("https?://"+this.baseDomain)))return this.log("No cachebust for url %s: not on timepad root",t),t;var e=null;if(this.settings.revisionsMap){var n=t.match(new RegExp("(https?://"+this.baseDomain+"/)(.+)"));n&&(e={base:n[1],url:n[2]},this.log("cachebust RevMaps available, will look for %s",e.url))}return e&&this.settings.revisionsMap[e.url]?(t=e.base+this.settings.revisionsMap[e.url],this.log("%s cachebusted with rev",t)):t.match(/\?/)||(t+="?ts="+TWF2._timestamp,this.log("%s cachebusted with ts",t)),t},sg.prototype.getRenderTarget=function(){return this.renderTarget||(this.renderTargetParent=document.createElement("div"),this.renderTargetParent.id=this.wuid+"_1",this._embedPoint.parentNode.insertBefore(this.renderTargetParent,this._embedPoint),this.renderTarget=document.createElement("div"),this.renderTarget.id=this.wuid+"_2",this.renderTargetParent.appendChild(this.renderTarget)),this.renderTarget},sg.prototype.createIframeElement=function(u,p,h){var g=this;this.log("[createIframe] loading JQuery"),this.loadJQuery(function(){g.log("[createIframe] JQuery ready");var t,e={width:0,height:0,autoHeight:!1,fill:!1,name:"tpwf_iframe",background:"none"},n=document.createElement("IFRAME");TWF2.T$.extend(!0,e,u),e.name&&(n.id=n.name=e.name),t={width:e.width,height:e.height,border:"0 none",background:e.background,display:"block"},e.fill&&(e.autoHeight=!1,t.width="100%",t.height="100%",t.overflow="scroll");var o=TWF2.T$(n);if(o.css(t),e.src&&(e.autoHeight=!1,n.src=e.src),g.log("[createIframe] calling embedder code"),p(o),g.log("[createIframe] calling ready handler"),h&&h(n,o),e.autoHeight){g.log("[createIframe] initializing autoHeight code"),o.css({overflow:"hidden"}).attr({seamless:"seamless",scrolling:"no"});var i,r,a=TWF2.T$(n.contentWindow.document.body);if((e.useVkResize||e.useVkScroll)&&window.VK){g.log("[createIframe][VK] trying VK mode");try{window.VK.init(function(){e.useVkResize&&(g.log("[createIframe][VK] applying vkResize function"),r=function(t){g.log("[createIframe][VK] VK.resizeWindow(%d, %d)",e.width,t),window.VK.callMethod("resizeWindow",e.width,t)}),e.useVkScroll&&(g.log("[createIframe][VK] creating scrollTop callback"),window.VK.addCallback("onScrollTop",function(t,e,n,i){g.log("[createIframe][VK] appOffsetTop = "+n),o.data("offsetTop",n)}),window.VK.callMethod("scrollTop"))})}catch(t){g.log("[createIframe][VK] vk mode failed: "+t)}}var s=0,c=g,d="string"==typeof e.onPreResize?window[e.onPreResize]:e.onPreResize,l="string"==typeof e.onPostResize?window[e.onPostResize]:e.onPostResize;window.setInterval(function(){if(i=a.height()){if(s==(i+=20))return;c.log("[createIframe][autoheight] resize triggered to %d",i),d&&d(),!r&&50<Math.abs(s-i)?(c.log("[createIframe] animated resize"),o.animate({height:i},300,function(){l&&l()})):(c.log("[createIframe] quick resize"),o.css({height:i}),l&&l()),s=i,r&&r(i)}},500)}})},sg.prototype.getMaxZIndex=function(t){var e=t.map(function(){var t;return isNaN(t=parseInt(TWF2.T$(this).css("z-index"),10))?0:t}).toArray();return Math.max.apply(null,e)},sg.prototype.createPopup=function(x,k,C,R){var F=this;this.log("[createPopup] loading JQuery"),this.loadJQuery(function(){F.log("[createPopup] JQuery ready");var l,t,e,u,p,n,i=F.getMaxZIndex(TWF2.T$("*")),o=TWF2.T$(document.body).css("min-height"),r=TWF2.T$(window),h={padding:15,addCss:{background:"white",border:"1px solid black"},tintColor:"rgba(0,0,0,.8)"},a=[r.innerWidth(),r.innerHeight()],s=TWF2.getViewport(),c={margin:"0",padding:"0",border:"0 none"},d={},g=TWF2.T$(document).scrollTop(),f=TWF2.T$(document).scrollLeft();x&&TWF2.T$.extend(!0,h,x);var m=parseInt(h.addCss.border)||0;if(t=TWF2.T$("<div>").addClass("twf-popup-drawtarget").css(c),h.autoShrink&&h.width>s[0]&&(h.padding=0),e=TWF2.T$("<div>").addClass("twf-popup-tint").css(c).css({position:"fixed","z-index":i+2,top:0,left:0,width:"100%",height:"100%",background:h.tintColor}),p=function(t){R&&(F.log("[createPopup] preClose called"),R(t)),F.log("[createPopup] closeHandle called"),e.remove(),l.remove(),TWF2.T$("html,body").css("min-height",o),C&&(F.log("[createPopup] called outer closeHandle"),C(t))},n=h.closeConfirm?function(t){F.log("[createPopup] closeRequest called");var e=F._instance,n=e.state.action,i=e.$currentDocumentNode.find(".twf-popup-closing-confirmation"),o=i.find(".confirmation-cont"),r=i.find(".confirmation-btn__proceed"),a=i.find(".confirmation-btn__close"),s=!h.closeConfirm.routes||-1!==h.closeConfirm.routes.indexOf(n);if(i.length&&s){if(!i.is(":visible")){u.hide();var c=parseFloat(l.css("padding-top")),d=TWF2.T$(document).scrollTop()-parseFloat(l.css("top"))-c;o.css("top",0<d?d+c:0),i.show(),a.click(function(t){return p("user")}),r.one("click",function(t){u.show(),i.hide(),t.preventDefault()})}}else p(t)}:p,!h.noClose){var w={display:"block",color:"black",position:"absolute",top:"5px",right:"5px","font-size":"30px",height:"17px","line-height":"17px","text-decoration":"none","font-family":"Arial, Helvetica, serif"};h.outerClose&&(w.color="white",w.top=-h.padding-17-1+"px",w.right="0px"),h.closeColor&&(w.color=h.closeColor),h.closeCss=h.closeCss||{},u=TWF2.T$("<a href='#'>").addClass("twf-popup-close").css(c).css(w).css(h.closeCss).text("×").click(function(t){t.preventDefault(),n("user")})}if(e.click(function(t){return n("user")}),h.margins)d={width:a[0]-2*h.margins[0]-2*h.padding+"px",left:h.margins[0]+"px",top:g+h.margins[1]+"px"};else if(h.width){var v,y=0,T=0,b=2*h.padding+2*m;if(h.autoShrink&&h.width>s[0]){if(v=s[0],h.minViewport>v){var W=v/h.minViewport;t.css({"-webkit-transform":"scale("+W+")","-webkit-transform-origin":"0 0",width:h.minViewport})}F.log("[createPopup] autoShrink to "+v)}else v=h.width-b,F.log("[createPopup] width calculated as "+v);v+b<a[0]&&(y=Math.floor((a[0]-v)/2)),h.horizontallyScrolled&&(y=f),T=g+h.padding,h.outerClose&&(T+=17),d={width:v+"px",left:y+"px",top:T+"px"}}e.appendTo(document.body),l=TWF2.T$("<div>").addClass("twf-popup-container").css(c).css(d).css({position:"absolute","box-sizing":"content-box","z-index":i+2,padding:h.padding+"px"}).css(h.addCss).append(t).append(u).appendTo(document.body);var S=0;window.setInterval(function(){S=t.height(),a[1]<S&&TWF2.T$("html,body").css("min-height",g+S+(h.margins?h.margins[1]:h.padding)+50+"px")},500),F.log("[createPopup] calling onCreate"),k&&k(t,l,n)})},sg.prototype.createIframePopup=function(t,r,a,e,i){var s=this;this.log("[createIframePopup] loading jQuery"),this.loadJQuery(function(){s.log("[createIframePopup] jQuery ready, creating popup");var n={width:"100%",height:"100%",autoHeight:!1};TWF2.T$.extend(!0,n,t),s.createPopup(r,function(e,t,o){s.log("[createIframePopup] popup ready, creating iframe"),s.createIframeElement(n,function(t){e.append(t)},function(t,e){s.log("[createIframePopup] iframe ready");var n,i=t.contentWindow.document;i.write("<!DOCTYPE html>\n<html><head></head><body></body></html>"),i.close(),n=i.querySelector("body"),a&&a(n,i,t),r.additionalClose&&TWF2.T$(i).on("click",r.additionalClose,function(){return o("user")}),s.appendEscHandler(t,i,o)})},e,i)})},sg.prototype.createIframePopupRenderTarget=function(t,e,o,i){var r=this;this.log("[createIframePopupRenderTarget] loading jQuery"),this.loadJQuery(function(){r.log("[createIframePopupRenderTarget] jQuery ready, creating popup");var n={width:"100%",height:"100%",autoHeight:!1,target:null};TWF2.T$.extend(!0,n,t),r.createPopup(e,function(t,e,i){r.log("[createIframePopupRenderTarget] popup ready, creating iframe RT"),n.target=t,r.createIframeRenderTarget(n,function(t,e,n){r.log("[createIframePopupRenderTarget] iframe RT ready, calling onCreate"),o(t,e,n,i)})},i)})},sg.prototype.createIframeRenderTarget=function(n,i){var o=this;this.createIframeElement(n,function(t){n.target?(n.target.empty(),n.target.append(t)):TWF2.T$(o._embedPoint).parent().insertBefore(t)},function(t,e){n.fill&&TWF2.T$([o.renderTarget,o.renderTargetParent]).css("height","100%"),t.contentWindow.document.write('<!DOCTYPE html>\n<html><head><style type="text/css">html, body {margin: 0; padding: .1px;}</style></head><body><div id="tpw_cont"></div></body></html>'),t.contentWindow.document.close(),o.renderTarget=t.contentWindow.document.getElementById("tpw_cont"),i&&i(o.renderTarget,t.contentWindow.document,t)})},sg.prototype.appendEscHandler=function(t,e,n){this.log("[appendEscHandler] appending callback"),TWF2.T$(e).on("keyup","body",function(t){return 27==t.keyCode&&n("user")}),TWF2.T$(t).focus()},sg.prototype.prependConsumerHost=function(t,e){void 0===e&&(e={});var n="https://";return e&&e.subdom&&(n+=e.subdom+"."),n+=this.baseDomain,e.noSlash||(n+="/"),n+=t},sg.prototype.loadJQuery=function(t){this.loadPackages(["jquery"],function(){return t()})},sg.prototype.openCORS=function(t,e){if(TWF2.xdm.debug&&!document.getElementById("log")){var n=document.createElement("div");n.id="log",this._embedPoint.parentNode.insertBefore(n,this._embedPoint)}this.loader.openCORS(t,e)},sg.prototype.loadPackages=function(t,e){var n=this,i=new TWF2.Util.F.all(e);TWF2.Collections.A.each(t,function(t){n.loader.loadPackage(t,n.base,i.cb())}),i.wait()},sg.prototype.applyCSS=function(t){t.replace(/WUID1/g,this.wuid+"_1").replace(/WUID2/g,this.wuid+"_2");var e=document.getElementsByTagName("head")[0],n=this.createStyleTag(t);if(!e)throw"Can't embed styles into headless page";return e.appendChild(n),n},sg.prototype.createStyleTag=function(t,e){void 0===e&&(e=document);var n=e.createElement("style");return n.setAttribute("type","text/css"),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(e.createTextNode(t)),n},sg.prototype.startMinimalSpinner=function(){if(document.querySelector){function t(t){return function(){n.innerHTML&&!n.querySelectorAll(".twf_loader").length||(n.innerHTML='<div class="twf_loader" style="color: gray; font-size: 12px; text-align: center; margin: 1em 0;">'+t+"</div>")}}var e=this._instance,n=this.getRenderTarget();e&&e.isReady||this.settings.hidePreloading||(this.minimalSpinnerTimeouts=[setTimeout(t("Загрузка..."),2e3),setTimeout(t("Всё еще загружаемся..."),8e3),setTimeout(t("Кажется, с виджетом что-то не так. Обратитесь, пожалуйста, на support@timepad.ru"),3e4)])}},sg.prototype.getTopmostWindow=function(t){return t.top===t?t:this.getTopmostWindow(t.top)},sg);function sg(t,e){var n=this;this.obs=new Observable(this),this.minimalSpinnerTimeouts=[],this.runnerSettings=e,this.name=t,this.loader=e.loader,this._embedPoint=e.embedPoint,this.wuid="tpw__"+TWF2.microguid(16),this.num=this.loader.getNewNumber(),this.settings=e.widgetSettings,this.customizationId=+e.customizationId,this.window=e.window,this.base=e.base,this.baseDomain=e.baseDomain,this.topmostWindow=this.getTopmostWindow(this.window),e.attachRunnerListeners&&TWF2.Collections.H.each(e.attachRunnerListeners,function(t,e){return n.obs.listen(e,t)}),this.obs.fireEvent("constructed",{},this)}TWF2.WidgetRunner=WidgetRunner;var Observable=(rj.prototype.listen=function(t,e){var n,i;(n=this.listeners)||(n=this.listeners={}),(i=n[t])||(i=n[t]=[]),i.push({method:e})},rj.prototype.fireEvent=function(t,e,n){var i,o,r,a;if(void 0===n&&(n=this.context),(i=this.listeners)&&(o=i[t])){for(r=0,a=o.length;r<a;r++)if(!1===o[r].method.call(n,e))return!1;return!0}},rj),DateUtils,Gj,JQueryCommon,Yj,Collections,fl,gl,nl,Om,Util;function rj(t){this.context=t}function ecopy(t){return extend({},t)}function extend(t,e,n){var i;for(var o in void 0===n&&(n=!1),e)e.hasOwnProperty(o)&&(o in t?"object"==typeof(i=e[o])?extend(t[o],i,n):n||(t[o]=e[o]):t[o]=e[o]);return t}function cascade(){for(var t=[],e=0;e<arguments.length;e++)t[+e]=arguments[e];var n={};return t.forEach(function(t){return TWF2.extend(n,t)}),n}function $j(t,e){if(void 0===e&&(e=null),!t.length)return 0;var n=t[0],i="true"===n.contentEditable;if(null!==e)return-1==e&&(e=this[i?"text":"val"]().length),window.getSelection&&(i?(n.focus(),window.getSelection().collapse(n.firstChild,e)):n.setSelectionRange(e,e)),i||n.focus(),e;if(window.getSelection){if(i){n.focus();var o=window.getSelection().getRangeAt(0),r=o.cloneRange();return r.selectNodeContents(n),r.setEnd(o.endContainer,o.endOffset),r.toString().length}return n.selectionStart}return n.selectionStart?n.selectionStart:0}function ol(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],+n)}function ql(t,e){var n=[];return t.forEach(function(t){return e(t,n)&&n.push(t)}),n}function sl(t,e){var n=[];return t.forEach(function(t){return e(t)&&n.push(t)}),n.slice(0,1).pop()}function ul(t,i){var o={};return t.forEach(function(t,e){var n=i(t,e);o[n.k]=n.v}),o}function xl(t,e){return ql(t,e).length===t.length}function yl(t,e){return!!sl(t,e)}function zl(t,e,n){return void 0===n&&(n=gl.exactEquality),yl(t,function(t){return n(t,e)})}function Al(e,t,n){return void 0===n&&(n=gl.exactEquality),xl(t,function(t){return zl(e,t,n)})}function Dl(t,e){void 0===e&&(e=gl.exactEquality);var n=[];return ol(t,function(t){return!zl(n,t,e)&&n.push(t)}),n}function Pm(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)}function getViewport(t){return void 0===t&&(t=document),[Math.max(t.documentElement.clientWidth,window.innerWidth||0),Math.max(t.documentElement.clientHeight,window.innerHeight||0)]}function getContainerWidth(t){var e=TWF2.T$("<div>").appendTo(t),n=parseInt(e.css("width"));return e.remove(),n}function microguid(t){return Math.random().toString(36).substr(2,t)}function stringHash(t){if(Array.prototype.reduce)return t.split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0);var e=0;if(0===t.length)return e;for(var n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return e}function equalsEX(t,e){if(t===e)return!0;if(!(t instanceof Object&&e instanceof Object))return!1;if(t.constructor!==e.constructor)return!1;for(var n in t)if(t.hasOwnProperty(n)){if(!e.hasOwnProperty(n))return!1;if(t[n]!==e[n]){if("object"!=typeof t[n])return!1;if(!equalsEX(t[n],e[n]))return!1}}for(n in e)if(e.hasOwnProperty(n)&&!t.hasOwnProperty(n))return!1;return!0}function getPreviousElementSibling(t){if(t.previousElementSibling)return t.previousElementSibling;for(;t=t.previousSibling;)if(1===t.nodeType)return t}TWF2.Observable=Observable,Gj=DateUtils=TWF2.DateUtils||(TWF2.DateUtils={}),Gj.months=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],Gj.zeroPad=function(t){var e=2-t.toString().length+1;return Array(+(0<e&&e)).join("0")+t},Gj.phpDateFormat=function(t){return t.getFullYear()+"-"+this.zeroPad(t.getMonth()+1)+"-"+this.zeroPad(t.getDate())},Gj.dateCopy=function(t){return new Date(t.valueOf())},TWF2.ecopy=ecopy,TWF2.extend=extend,TWF2.cascade=cascade,Yj=JQueryCommon=TWF2.JQueryCommon||(TWF2.JQueryCommon={}),Yj.$plusMinus=function(t,g,f){void 0===f&&(f=function(t,e){return e});var m={min:0,burst_timeout:0},w=g.logger||function(){};w("PlusMinus initializer called on collection %O",t),t.TWFiter(function(a){w("PlusMinus initializer called on element %O",a);var s,t={},e=a.find(".js-plusminus_minus"),n=a.find(".js-plusminus_plus"),c=a.find(".js-plusminus_value"),i=a.find(".js-plusminus_display");void 0!==a.data("plusminus-min")&&(t.min=a.data("plusminus-min")),void 0!==a.data("plusminus-max")&&(t.max=a.data("plusminus-max")),s=TWF2.cascade(m,t,g),w("PlusMinus combined settings: %O",s);function d(t){var e=+t;return isNaN(e)&&(e=0),w("validated %s -> %d",t,e),e}function o(t){w("Checking changes %s -> %s",t,p),t!==p&&(w("Change detected, firing event!"),c.trigger("change",!0))}function l(){var t=p;if(w("setTimeoutChangeHandler originalVal = %d",t),!s.burst_timeout)return w("Burst protection disabled"),p=c.val(),void o(t);null===h&&w("burstVal not set, setting burstVal = %s",h=t),w("Creating burst timeout handler, burstVal = %s",h),null!==u&&(w("Clearing existing timeout"),window.clearTimeout(u)),u=window.setTimeout(function(){var t=h;p=c.val(),h=null,w("Ending burst"),o(t)},s.burst_timeout)}function r(r){return function(t){var e,n,i,o;t.preventDefault(),e=c.val(),w("handlePlusMinusButtons inc = %d, curVal = %s",r,e),n=d(e),o=d(n+r),w("validatedCurVal = %d, incrementedVal = %d",n,o),null!==s.min&&void 0!==s.min&&(s.allow_zero_below_min&&o<s.min?(w("Changed val %d is below min (%d), inc = %d. Using allow_zero_below_min mode",o,s.min,r),o=0<r?s.min:0,w("Setting val to %d",o)):(w("Validating against min %d",s.min),o=Math.max(s.min,o))),null!==s.max&&void 0!==s.max&&(w("Validating against max %d",s.max),o=Math.min(s.max,o)),o=f(a,o),c.val(o),i=c.val(),w("PlusMinus %s -> %s",e,i),l()}}var u=null,p=c.val(),h=null;e.click(r(-1)),n.click(r(1)),c.on("change",null,function(t,e){if(w("Change handler"),i.text(c.val()),e)return w("event fired by ourseleves, no double-checking"),!0;var n=d(c.val());null!==s.min&&void 0!==s.min&&(n=Math.max(s.min,n)),null!==s.max&&void 0!==s.max&&(n=Math.min(s.max,n)),n=f(a,n),c.val(n),l()}).focus(function(){return c.select()})})},Yj.$caret=$j,Yj.$tpphone=function(t){return t.TWFiter(function(f){f.keyup(function(t){if(-1!=TWF2.T$.inArray(t.keyCode,[37,38,39,40]))return!0;for(var e=f.val(),n=$j(f),i="#0",o=!1,r="",a="",s=0,c=0,d=e.length;c<d;c++)e.charAt(c).match(/[\d]/)&&(a+=e.charAt(c)),c<n&&(s=a.length);if("8"==a.charAt(0)&&"9"==a.charAt(1)&&(a=a.replace("8","7")),a.length<=11?(i="+0 (000) 000-00-000",o=!0):12==a.length?(i="+00 (000) 000-00-000",o=!0):13==a.length?(i="+000 (000) 000-00-000",o=!0):13<a.length&&(o=!(i="#0")),o){for(var l=0,u=i.length,p=0,h=0,g=a.length;h<g;h++){for(;l<u;l++){if("0"==i.charAt(l)){r+=a.charAt(h),l++;break}r+=i.charAt(l)}s==h+1&&(p=r.length)}f.val(r),$j(f,p)}})})},fl=Collections=TWF2.Collections||(TWF2.Collections={}),(gl=fl.Comparators||(fl.Comparators={})).exactEquality=function(t,e){return t===e},(nl=fl.A||(fl.A={})).each=ol,nl.map=function(t,e){var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(e(t[i],+i));return n},nl.where=ql,nl.removeWhere=function(e,n){var i=[];e.forEach(function(t,e){return n(t,i)&&i.push(e)}),i.forEach(function(t){return e.splice(t,1)})},nl.whereSingle=sl,nl.arrayCount=function(t,e){var n=0;return t.forEach(function(t){return e(t)&&n++}),n},nl.toHash=ul,nl.toFlags=function(t){return ul(t,function(t){return{k:t,v:!0}})},nl.shuffle=function(t){for(var e,n,i=t.length;i;e=Math.floor(Math.random()*i),n=t[--i],t[i]=t[e],t[e]=n);return t},nl.all=xl,nl.any=yl,nl.contains=zl,nl.containsAll=Al,nl.containsOnly=function(t,e,n){return void 0===n&&(n=gl.exactEquality),Al(e,t,n)},nl.copy=function(t){return t.slice(0)},nl.uniq=Dl,nl.merge=function(){for(var t=[],e=0;e<arguments.length;e++)t[+e]=arguments[e];var n=[];return ol(t,function(t){return n=n.concat(t)}),Dl(n)},nl.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},(Om=fl.H||(fl.H={})).each=Pm,Om.ifAll=function(t,n){var i=!0;return Pm(t,function(t,e){return i=i&&n(t,e)}),i},Om.map=function(t,n){var i,o={};return Pm(t,function(t,e){i=n(t,e),o[i.k]=i.v}),o},Om.mapToArray=function(t,n){var i=[];return Pm(t,function(t,e){i.push(n(t,e))}),i},Om.where=function(t,n){var i={};return Pm(t,function(t,e){return n(t,e,i)&&(i[e]=t)}),i},Om.keys=function(t){if(Object.keys)return Object.keys(t);var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(e);return n},function(t){var a,s,e,n;function i(t){return null==t}function o(t,e){return i(t)?e:t}function r(t){return o(t,[])}function c(){var t=s,e=Collections,n=t.S(document.cookie),i=t.A(n.split(/;\s/)),o={};return e.A.each(i,function(t){var e=t.split(/=/);if(2===e.length)try{o[e[0]]=decodeURIComponent(e[1])}catch(t){}}),o}!function(t){function n(t,e,n){function i(){return o.apply(t,arguments)}var o=t[e];t[e]=function(){return n(i,t,arguments)}}t.chain=function(t,e,o){var r=function(t,e){if(e.length){var n,i=[];Collections.A.each(e,function(t,e){return e?i.push(t):n=t}),t(function(){return r(t,i)},n)}else o&&o()};r(t,e)},t.wrap=n,t.after=function(t,e,o){n(t,e,function(t,e,n){var i=t.apply(e,n);return o(e,n,i),i})},t.before=function(t,e,i){n(t,e,function(t,e,n){return i(e,n),t.apply(e,n)})},t.once=function(t,e){var n,i=!1;return function(){return i||(n=e.apply(t,arguments)),i=!0,n}};var e=(i.prototype.cb=function(){var t=this;return this.callbackCount++,function(){t.callbackCount--,t.active&&t.callbackCount<=0&&t.finalCallback()}},i.prototype.wait=function(){this.active=!0,this.callbackCount||this.finalCallback()},i);function i(t){this.callbackCount=0,this.active=!1,this.finalCallback=t}t.all=e}(t.F||(t.F={})),(a=t.PHP||(t.PHP={})).mt_rand=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=2147483647),t=parseInt(t,10),e=parseInt(e,10),Math.floor(Math.random()*(e-t+1))+t},(e=s=t.EnsureType||(t.EnsureType={})).notNullOrUndefined=o,e.S=function(t){return i(t)?"":t+""},e.A=r,e.H=function(t){return o(t,{})},e.index=function(t,e,n){return e(r(t)[n])},(t.S||(t.S={})).nl2br=function(t){return s.S(t).replace(/[\r\n]+/g,"<br>\n")},(n=t.Cookies||(t.Cookies={})).getCookies=c,n.getCookie=function(t){return c()[t]},n.setCookie=function(t,e,n,i,o,r){if(t&&e){var a=t+"="+encodeURIComponent(e);n&&(a+="; expires="+n.toGMTString()),i&&(a+="; path="+i),o&&(a+="; domain="+o),r&&(a+="; secure"),document.cookie=a}};var d=(l.prototype.setFragment=function(t,e){this.fragments[t]=e},l.prototype.setFragments=function(t){var n=this;Collections.H.each(t,function(t,e){return n.setFragment(e,t)})},l.prototype.mergeIn=function(t){this.setFragments(t.fragments)},l.fromUrl=function(t){var e=s,n=Collections,i=e.index(t.match(/[?](.*)/),e.S,1),o=e.A(i.split(/[&]/)),r=new l;return n.A.each(o,function(t){var e=t.split(/=/);2===e.length&&r.setFragment(e[0],decodeURIComponent(e[1]))}),r},l.deparam=function(t,c){var d={},l={true:!0,false:!1,null:null};return t&&t.replace(/\+/g," ").split("&").forEach(function(t){var e,n=t.split("="),i=decodeURIComponent(n[0]),o=d,r=0,a=i.split("]["),s=a.length-1;if(s=/\[/.test(a[0])&&/\]$/.test(a[s])?(a[s]=a[s].replace(/\]$/,""),(a=a.shift().split("[").concat(a)).length-1):0,2===n.length)if(e=decodeURIComponent(n[1]),c&&(e=e&&!isNaN(e)&&+e+""===e?+e:"undefined"===e?void 0:void 0!==l[e]?l[e]:e),s)for(;r<=s;r++)o=o[i=""===a[r]?o.length:a[r]]=r<s?o[i]||(a[r+1]&&isNaN(a[r+1])?{}:[]):e;else"[object Array]"===Object.prototype.toString.call(d[i])?d[i].push(e):{}.hasOwnProperty.call(d,i)?d[i]=[d[i],e]:d[i]=e;else i&&(d[i]=c?void 0:"")}),d},l);function l(t){this.fragments={},t&&this.setFragments(t)}t.QueryString=d;var u=(p.fromHex=function(t,e){void 0===e&&(e=1);var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),i=0,o=0,r=0;return n&&(i=parseInt(n[1],16),o=parseInt(n[2],16),r=parseInt(n[3],16)),new p(i,o,r,e)},p.fromHSL=function(t,e,n){function i(t,e){return t%e/parseFloat(e)}function o(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}var r,a,s;if(t=i(t,360),e=i(e,100),n=i(n,100),0===e)r=a=s=n;else{var c=n<.5?n*(1+e):n+e-n*e,d=2*n-c;r=o(d,c,t+1/3),a=o(d,c,t),s=o(d,c,t-1/3)}return new p(255*r,255*a,255*s)},p.random=function(t,e){function n(t){return void 0===t&&(t=[0,1]),a.mt_rand(t[0],t[1])}void 0===t&&(t=[0,100]),void 0===e&&(e=[0,100]);var i=n([1,360]),o=n(t),r=n(e);return p.fromHSL(i,o,r)},p.prototype.setAlpha=function(t){return this.a=parseFloat(t),this},p.prototype.console=function(){window.console&&console.log("%c"+this.asRgba(),"background: "+this.asRgba())},p.prototype.asRgba=function(){return"rgba("+[this.r,this.g,this.b,this.a.toFixed(2)].join(",")+")"},p);function p(t,e,n,i){void 0===i&&(i=1),this.r=parseInt(t,10),this.g=parseInt(e,10),this.b=parseInt(n,10),this.setAlpha(i)}t.Color=u,t.isMobileBrowser=function(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4))}}(Util=TWF2.Util||(TWF2.Util={})),TWF2.getViewport=getViewport,TWF2.getContainerWidth=getContainerWidth,TWF2.microguid=microguid,TWF2.stringHash=stringHash,TWF2.equalsEX=equalsEX,Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0==n)return-1;var i=0;if(1<arguments.length&&((i=Number(arguments[1]))!=i?i=0:0!=i&&i!=1/0&&i!=-1/0&&(i=(0<i||-1)*Math.floor(Math.abs(i)))),n<=i)return-1;for(var o=0<=i?i:Math.max(n-Math.abs(i),0);o<n;o++)if(o in e&&e[o]===t)return o;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),r=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(1<arguments.length&&(n=e),i=0;i<r;){var a;i in o&&(a=o[i],t.call(n,a,i,o)),i++}}),Function.prototype.bind||(Function.prototype.bind=function(i){function o(){}var r=this,a=1<arguments.length?Array.slice(arguments,1):null,s=function(){var t=i,e=arguments.length;this instanceof s&&(o.prototype=r.prototype,t=new o);var n=a||e?r.apply(t,a&&e?a.concat(Array.slice(arguments)):a||arguments):r.call(t);return t==i?n:t};return s}),"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(t){"use strict";if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var e,n=Object(this),i=n.length>>>0,o=0;if(2<=arguments.length)e=arguments[1];else{for(;o<i&&!o in n;)o++;if(i<=o)throw new TypeError("Reduce of empty array with no initial value");e=n[o++]}for(;o<i;o++)o in n&&(e=t(e,n[o],o,n));return e}),TWF2.getPreviousElementSibling=getPreviousElementSibling;var MassLoader=(dr.prototype.checkAll=function(){var t=this;if(!this.fired)if(this.active){if(this.allReady=TWF2.Collections.H.ifAll(this.events,function(t){return t.isLoaded}),this.allReady){var e=TWF2.Collections.H.map(this.events,function(t,e){return{k:e,v:t.result}});this.fired=!0,this.o.fireEvent("allReady",e)}}else this.o.listen("activated",function(){return t.checkAll()})},dr.prototype.wait=function(e){this.o.listen("allReady",function(t){return e(t)}),this.active=!0,this.o.fireEvent("activated",{})},dr.prototype.addEvent=function(t){var e=this;if(this.active)throw"Already activated the trap";var n={isLoaded:!1};return this.events[t]=n,function(){n.result=arguments,n.isLoaded=!0,e.checkAll()}},dr);function dr(){this.events={},this.allReady=!1,this.active=!1,this.fired=!1,this.o=new Observable(this)}TWF2.MassLoader=MassLoader,Loader.getInstance().loadWidgets()}(TWF2=TWF2||{});